<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>AR Business Card (Scanning UI + Overlay at Bottom)</title>

    <!-- A-Frame core library -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- MindAR for A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <!-- A-Frame FBX Loader -->
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-extras@6.1.1/dist/aframe-extras.loaders.min.js"></script>

    <!-- Basic styling -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      /* Hide default A-Frame VR buttons only */
      button.a-enter-vr,
      .a-enter-vr-button,
      .a-enter-ar-button,
      .a-enter-ar,
      .a-enter-vr {
        display: none !important;
      }

      /* Ensure MindAR scanning UI remains visible */
      .mindar-ui-overlay {
        pointer-events: none;
      }

      /* The HTML overlay for left-image */
      #leftImageOverlay {
        position: absolute;
        display: none;
        pointer-events: auto;
      }

      /* The HTML overlay for social links */
      #markerOverlay {
        position: absolute;
        display: none;
        pointer-events: auto;
      }
    </style>
  </head>
  <body>
    <a-scene
      mindar-image="
        imageTargetSrc: ./targets.mind;
        autoStart: true;
      "
      device-orientation-permission-ui="enabled: true"
      vr-mode-ui="enabled: false"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    >
      <a-camera look-controls="enabled: false"></a-camera>

      <!-- AR marker entity with our custom sync-html component -->
      <a-entity id="marker" mindar-image-target="targetIndex: 0" sync-html>
        <!-- Left Image in AR -->
        <a-image
          src="./icons/left--image.jpg"
          position="-0.9 0 0"
          width="0.5"
          height="0.5"
          onclick="window.open('https://blog.vnshkumar.com/','_blank')"
        ></a-image>

        <!-- 3D Model Positioned on Top of the Target -->
        <a-entity
          position="0 1 0"
          scale="0.01 0.01 0.01"
          fbx-model="url(./Waving.fbx)"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"
        ></a-entity>
      </a-entity>
    </a-scene>

    <!-- HTML Overlay for left-image -->
    <div id="leftImageOverlay">
      <img
        src="./icons/left--image.jpg"
        alt="Left Image"
        style="width: 100px; height: 100px; cursor: pointer; margin: 20px;"
        onclick="window.open('https://blog.vnshkumar.com/','_blank')"
      />
    </div>

    <!-- HTML Overlay for social links -->
    <div id="markerOverlay">
      <img
        src="./icons/facebook.png"
        alt="Facebook"
        style="width: 80px; height: 80px; cursor: pointer; margin-right: 10px; margin-top: 300px;"
        onclick="window.open('https://blog.vnshkumar.com/','_blank')"
      />
      <img
        src="./icons/instagram.png"
        alt="Instagram"
        style="width: 80px; height: 80px; cursor: pointer; margin-right: 10px; margin-top: 300px;"
        onclick="window.open('https://www.instagram.com/kumar.vnsh/','_blank')"
      />
      <img
        src="./icons/linkedin.png"
        alt="LinkedIn"
        style="width: 80px; height: 80px; cursor: pointer; margin-top: 300px;"
        onclick="window.open('https://www.linkedin.com/in/vnshkumar/','_blank')"
      />
    </div>

    <!-- Sync HTML Overlay with Marker -->
    <script>
      AFRAME.registerComponent('sync-html', {
        init: function() {
          const markerEl = this.el;
          const leftImageOverlay = document.getElementById("leftImageOverlay");
          const socialOverlay = document.getElementById("markerOverlay");

          markerEl.addEventListener("targetFound", () => {
            leftImageOverlay.style.display = "block";
            socialOverlay.style.display = "block";
          });

          markerEl.addEventListener("targetLost", () => {
            leftImageOverlay.style.display = "none";
            socialOverlay.style.display = "none";
          });
        },

        tick: function() {
          if (!this.el.object3D.visible) return;

          // Get marker position
          const markerWorldPos = new THREE.Vector3();
          markerWorldPos.setFromMatrixPosition(this.el.object3D.matrixWorld);

          // Adjust positions for overlays
          const camera = this.el.sceneEl.camera;
          markerWorldPos.project(camera);

          const screenX = (markerWorldPos.x * 0.5 + 0.5) * window.innerWidth;
          const screenY = (-markerWorldPos.y * 0.5 + 0.5) * window.innerHeight;

          const leftImageOverlay = document.getElementById("leftImageOverlay");
          leftImageOverlay.style.transform = `translate(-50%, -50%) translate(${screenX - 100}px, ${screenY}px)`;

          const socialOverlay = document.getElementById("markerOverlay");
          socialOverlay.style.transform = `translate(-50%, -50%) translate(${screenX}px, ${screenY + 100}px)`;
        }
      });
    </script>
  </body>
</html>
